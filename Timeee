import pandas as pd
import win32com.client

# Load the Excel file into a DataFrame
df = pd.read_excel('your_excel_file.xlsx')

# Calculate the deviation and filter rows with deviation > 15%
df['Deviation'] = ((df['Present'] - df['Past']) / df['Past']) * 100
filtered_df = df[df['Deviation'] > 15]

# Create a proper-looking table with the 3 columns
filtered_df = filtered_df[['Past', 'Present', 'Deviation']]

# Attach the DataFrame to an Outlook email
outlook = win32com.client.Dispatch('Outlook.Application')
mail = outlook.CreateItem(0)
mail.Subject = 'Filtered Data Report'
mail.Body = 'Please find the attached filtered data.'
mail.Attachments.Add('filtered_data.xlsx')
mail.To = 'recipient@email.com'
mail.Send()

print("Email sent with the filtered data.")






import pandas as pd
import win32com.client

# Load the Excel file into a DataFrame
df = pd.read_excel('your_excel_file.xlsx')

# Calculate the deviation and filter rows with deviation > 15%
df['Deviation'] = ((df['Present'] - df['Past']) / df['Past']) * 100
filtered_df = df[df['Deviation'] > 15]

# Create an HTML table
html_table = filtered_df.to_html(index=False)

# Create an Outlook email
outlook = win32com.client.Dispatch('Outlook.Application')
mail = outlook.CreateItem(0)
mail.Subject = 'Filtered Data Report'
mail.HTMLBody = f"<p>Please find the attached table:</p>{html_table}"
mail.To = 'recipient@email.com'
mail.Send()

print("Email sent with the filtered data table.")
